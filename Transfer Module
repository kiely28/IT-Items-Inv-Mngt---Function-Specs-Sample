Ah! That explains the error perfectly. üòÑ

Your database column and Item model use WarrantyExpiration instead of Warranty. So anywhere in the controller or view you wrote item.Warranty needs to be updated to item.WarrantyExpiration.

Let‚Äôs fix it properly.


---

üîπ Step 1 ‚Äî Update TransferController

In TransferController.cs, replace:

model.Warranty = item.Warranty;

with:

model.Warranty = item.WarrantyExpiration?.ToString("yyyy-MM-dd"); // or just .ToString()

I‚Äôm assuming WarrantyExpiration is DateTime? in the model.

If it‚Äôs string, just use item.WarrantyExpiration.


Also, in the stored procedure call, pass WarrantyExpiration as string:

new SqlParameter("@Warranty", model.Warranty ?? (object)DBNull.Value)


---

üîπ Step 2 ‚Äî Update TransferViewModel

Currently your TransferViewModel has:

public string? Warranty { get; set; }

Since your database column is WarrantyExpiration, you can keep it as string? to display in the view.
It will just show the expiration date.

public string? Warranty { get; set; } // holds WarrantyExpiration date as string


---

üîπ Step 3 ‚Äî Update Views (Optional)

Where you display the Warranty in Index.cshtml:

<p><strong>Warranty Expiration:</strong> @Model.Warranty</p>


---

üîπ Step 4 ‚Äî Summary

Change all references from Warranty ‚Üí WarrantyExpiration in code.

Transfer stored procedure can still accept @Warranty NVARCHAR(50); just pass the date as string.

This fixes the Item does not contain a definition for 'Warranty' error.



---

If you want, I can now rewrite the Transfer Only module fully using WarrantyExpiration, updating item location and preventing over-transfer, so it works cleanly with your current Item model.

Do you want me to do that?

**

Ah! That error explains exactly what‚Äôs going on: your tbl_items (or Item model) doesn‚Äôt have a Warranty property, so the code trying to read item.Warranty fails.

We need to match the model to the database table.


---

üîπ Step 1 ‚Äî Check Your Item Model

Your current Item model probably looks like this:

public class Item
{
    public int ItemID { get; set; }
    public string ControlNo { get; set; } = string.Empty;
    public int Quantity { get; set; }
    public string Location { get; set; } = string.Empty;
}

Notice there‚Äôs no Warranty property.


---

üîπ Step 2 ‚Äî Add Warranty Property

Update your Item model to include it:

public class Item
{
    public int ItemID { get; set; }
    public string ControlNo { get; set; } = string.Empty;
    public int Quantity { get; set; }
    public string Location { get; set; } = string.Empty;

    // Add this line
    public string? Warranty { get; set; }
}

> string? because it can be null if not all items have a warranty.




---

üîπ Step 3 ‚Äî Update Database (Optional)

If your table tbl_items does not have a Warranty column, you need to add it:

ALTER TABLE tbl_items
ADD Warranty NVARCHAR(50) NULL;


---

üîπ Step 4 ‚Äî Verify EF Core Mapping

If using EF Core migrations, add migration & update database:

dotnet ef migrations add AddWarrantyToItem
dotnet ef database update


---

üîπ Step 5 ‚Äî Use in TransferController

Now this line will work without errors:

model.Warranty = item.Warranty;


---

‚úÖ After this, the Transfer module will correctly read the warranty from the item and pass it to the stored procedure.


---

If you want, I can rewrite the Transfer Only page so it works even if some items don‚Äôt have Warranty, making it fully beginner-proof.

Do you want me to do that?

**


'Item' does not contain a definition for 'Warranty' and no accessible extension method 'Warranty' accepting a first argument of type 'Item' could be found (are you missing a using directive or an assembly reference?)

**

Below is a simple and clean ‚ÄúTransfer Only‚Äù View + Logic that:

‚úÖ Updates the item location in tbl_items

‚úÖ Updates the item‚Äôs quantity (subtracts transferred quantity)

‚ùå Prevents over-transfer (quantity > available stock)

üéØ Only one page (Transfer View + POST logic)

üß± Uses Stored Procedure + EF Core + ASP.NET Core MVC 8


---

üóÑ Step 1 ‚Äî SQL Stored Procedure

This stored procedure will:

1. Check if quantity to transfer is greater than available stock ‚Üí prevent


2. If OK:

Insert into tbl_Transfer

Update tbl_items.Quantity

Update tbl_items.Location





---

üìå Stored Procedure: sp_TransferItem

CREATE PROCEDURE sp_TransferItem
    @ControlNo NVARCHAR(50),
    @Warranty NVARCHAR(50),
    @Quantity INT,
    @Location NVARCHAR(150)
AS
BEGIN
    SET NOCOUNT ON;

    DECLARE @CurrentQty INT;

    SELECT @CurrentQty = Quantity 
    FROM tbl_items 
    WHERE ControlNo = @ControlNo;

    IF @CurrentQty IS NULL
    BEGIN
        RAISERROR('Item not found.', 16, 1);
        RETURN;
    END

    IF @Quantity > @CurrentQty
    BEGIN
        RAISERROR('Transfer quantity exceeds available stock.', 16, 1);
        RETURN;
    END

    -- Insert transfer history
    INSERT INTO tbl_Transfer (ControlNo, Warranty, Quantity, Location)
    VALUES (@ControlNo, @Warranty, @Quantity, @Location);

    -- Update item stock
    UPDATE tbl_items
    SET Quantity = Quantity - @Quantity,
        Location = @Location
    WHERE ControlNo = @ControlNo;
END
GO


---

üß© Step 2 ‚Äî Create Transfer View-Model

Create file:

Models/TransferViewModel.cs

namespace InventorySystem.Models
{
    public class TransferViewModel
    {
        public string ControlNo { get; set; } = string.Empty;
        public string? Warranty { get; set; }
        public int Quantity { get; set; }
        public string Location { get; set; } = string.Empty;

        // For showing available quantity
        public int AvailableQuantity { get; set; }
    }
}


---

üõ† Step 3 ‚Äî Controller Logic

Only one screen:

GET = show available quantity

POST = call stored procedure + validate


üìå TransferController.cs

using InventorySystem.Data;
using InventorySystem.Models;
using Microsoft.AspNetCore.Mvc;
using Microsoft.Data.SqlClient;
using Microsoft.EntityFrameworkCore;

namespace InventorySystem.Controllers
{
    public class TransferController : Controller
    {
        private readonly ApplicationDbContext _context;

        public TransferController(ApplicationDbContext context)
        {
            _context = context;
        }

        // ===================== TRANSFER SCREEN =====================
        public async Task<IActionResult> Index(string? controlNo)
        {
            var model = new TransferViewModel();

            if (!string.IsNullOrEmpty(controlNo))
            {
                var item = await _context.Items
                    .Where(i => i.ControlNo == controlNo)
                    .FirstOrDefaultAsync();

                if (item != null)
                {
                    model.ControlNo = item.ControlNo;
                    model.AvailableQuantity = item.Quantity;
                    model.Warranty = item.Warranty;
                }
                else
                {
                    ViewBag.Error = "Item not found.";
                }
            }

            return View(model);
        }

        // ===================== POST TRANSFER =====================
        [HttpPost]
        public async Task<IActionResult> Index(TransferViewModel model)
        {
            if (model.Quantity <= 0)
            {
                ViewBag.Error = "Quantity must be greater than zero.";
                return View(model);
            }

            try
            {
                await _context.Database.ExecuteSqlRawAsync(
                    "EXEC sp_TransferItem @ControlNo, @Warranty, @Quantity, @Location",
                    new SqlParameter("@ControlNo", model.ControlNo),
                    new SqlParameter("@Warranty", model.Warranty ?? (object)DBNull.Value),
                    new SqlParameter("@Quantity", model.Quantity),
                    new SqlParameter("@Location", model.Location)
                );

                ViewBag.Success = "Transfer completed successfully!";
            }
            catch (SqlException ex)
            {
                // User-friendly error
                ViewBag.Error = ex.Message;
            }

            // Reload available quantity
            var item = await _context.Items
                .Where(i => i.ControlNo == model.ControlNo)
                .FirstOrDefaultAsync();

            if (item != null)
                model.AvailableQuantity = item.Quantity;

            return View(model);
        }
    }
}


---

üé® Step 4 ‚Äî Transfer View (Single Page)

üìå Views/Transfer/Index.cshtml

@model InventorySystem.Models.TransferViewModel

<h2>Item Transfer</h2>

<form method="get">
    <div class="mb-3">
        <label>Control No</label>
        <input name="controlNo" class="form-control" value="@Model.ControlNo" />
    </div>
    <button class="btn btn-secondary">Load Item</button>
</form>

@if (ViewBag.Error != null)
{
    <div class="alert alert-danger mt-3">@ViewBag.Error</div>
}

@if (ViewBag.Success != null)
{
    <div class="alert alert-success mt-3">@ViewBag.Success</div>
}

@if (!string.IsNullOrEmpty(Model.ControlNo))
{
<form method="post">
    <input type="hidden" asp-for="ControlNo" />
    <input type="hidden" asp-for="Warranty" />

    <div class="mt-4 p-3 border rounded">
        <h4>Item Details</h4>
        <p><strong>Control No:</strong> @Model.ControlNo</p>
        <p><strong>Warranty:</strong> @Model.Warranty</p>
        <p><strong>Available Quantity:</strong> @Model.AvailableQuantity</p>

        <div class="mb-3">
            <label>Quantity to Transfer</label>
            <input asp-for="Quantity" class="form-control" />
        </div>

        <div class="mb-3">
            <label>New Location</label>
            <input asp-for="Location" class="form-control" />
        </div>

        <button class="btn btn-primary">Submit Transfer</button>
    </div>
</form>
}


---

üéØ How it works

‚úî 1. User enters ControlNo

‚Üí System loads item info + available stock.

‚úî 2. User enters quantity + new location

‚Üí System checks if quantity > available stock inside stored procedure.

‚úî 3. Good?

Inserts into tbl_Transfer

Updates tbl_items.Quantity = Quantity - Transferred

Updates tbl_items.Location = New Location


‚úî 4. Bad?

Shows error "Transfer quantity exceeds available stock"



---

üöÄ Want It More Advanced?

I can add:

‚úî Auto-suggest ControlNo (search dropdown)
‚úî Prevent transfer if item is disposed/repaired
‚úî Track old & new locations
‚úî Barcode scanning
‚úî DataTables UI
‚úî Transfer history report

Just tell me: ‚ÄúUpgrade transfer module‚Äù

**


Below is a complete beginner-friendly Transfer Module for your ASP.NET Core MVC 8 + EF Core + Stored Procedures project.
This module includes:

ControlNo

Warranty

Quantity

Location


and explains whether it updates tbl_items.location (optional ‚Äì you decide).


---

‚úÖ Step 1 ‚Äî SQL Table: tbl_Transfer

Run this in SQL Server:

CREATE TABLE tbl_Transfer (
    TransferID INT IDENTITY(1,1) PRIMARY KEY,
    ControlNo NVARCHAR(50) NOT NULL,
    Warranty NVARCHAR(50),
    Quantity INT NOT NULL,
    Location NVARCHAR(150) NOT NULL,
    DateTransferred DATETIME DEFAULT GETDATE()
);


---

‚úÖ Step 2 ‚Äî Stored Procedures

1. Add Transfer

CREATE PROCEDURE sp_AddTransfer
    @ControlNo NVARCHAR(50),
    @Warranty NVARCHAR(50),
    @Quantity INT,
    @Location NVARCHAR(150)
AS
BEGIN
    INSERT INTO tbl_Transfer (ControlNo, Warranty, Quantity, Location)
    VALUES (@ControlNo, @Warranty, @Quantity, @Location);
END
GO

2. Get All Transfers

CREATE PROCEDURE sp_GetAllTransfers
AS
BEGIN
    SELECT * FROM tbl_Transfer ORDER BY TransferID DESC;
END
GO

3. Get by ID

CREATE PROCEDURE sp_GetTransferById
    @TransferID INT
AS
BEGIN
    SELECT * FROM tbl_Transfer WHERE TransferID = @TransferID;
END
GO

4. Update

CREATE PROCEDURE sp_UpdateTransfer
    @TransferID INT,
    @ControlNo NVARCHAR(50),
    @Warranty NVARCHAR(50),
    @Quantity INT,
    @Location NVARCHAR(150)
AS
BEGIN
    UPDATE tbl_Transfer
    SET ControlNo = @ControlNo,
        Warranty = @Warranty,
        Quantity = @Quantity,
        Location = @Location
    WHERE TransferID = @TransferID;
END
GO

5. Delete

CREATE PROCEDURE sp_DeleteTransfer
    @TransferID INT
AS
BEGIN
    DELETE FROM tbl_Transfer WHERE TransferID = @TransferID;
END
GO


---

‚úÖ Step 3 ‚Äî Model: Transfer.cs

Create file in Models:

namespace InventorySystem.Models
{
    public class Transfer
    {
        public int TransferID { get; set; }
        public string ControlNo { get; set; } = string.Empty;
        public string? Warranty { get; set; }
        public int Quantity { get; set; }
        public string Location { get; set; } = string.Empty;
        public DateTime DateTransferred { get; set; }
    }
}


---

‚úÖ Step 4 ‚Äî Add to DbContext

In ApplicationDbContext.cs:

public DbSet<Transfer> Transfers { get; set; }


---

‚úÖ Step 5 ‚Äî Controller: TransferController.cs

Create this controller:

using InventorySystem.Data;
using InventorySystem.Models;
using Microsoft.AspNetCore.Mvc;
using Microsoft.Data.SqlClient;
using Microsoft.EntityFrameworkCore;

namespace InventorySystem.Controllers
{
    public class TransferController : Controller
    {
        private readonly ApplicationDbContext _context;

        public TransferController(ApplicationDbContext context)
        {
            _context = context;
        }

        // ================= READ ALL =====================
        public async Task<IActionResult> Index()
        {
            var transfers = await _context.Transfers
                .FromSqlRaw("EXEC sp_GetAllTransfers")
                .ToListAsync();

            return View(transfers);
        }

        // ================= CREATE =====================
        public IActionResult Create()
        {
            return View();
        }

        [HttpPost]
        public async Task<IActionResult> Create(Transfer transfer)
        {
            if (ModelState.IsValid)
            {
                await _context.Database.ExecuteSqlRawAsync(
                    "EXEC sp_AddTransfer @ControlNo, @Warranty, @Quantity, @Location",
                    new SqlParameter("@ControlNo", transfer.ControlNo),
                    new SqlParameter("@Warranty", transfer.Warranty ?? (object)DBNull.Value),
                    new SqlParameter("@Quantity", transfer.Quantity),
                    new SqlParameter("@Location", transfer.Location)
                );

                return RedirectToAction(nameof(Index));
            }
            return View(transfer);
        }

        // ================= EDIT =====================
        public async Task<IActionResult> Edit(int id)
        {
            var transfer = await _context.Transfers
                .FromSqlRaw("EXEC sp_GetTransferById @Id", new SqlParameter("@Id", id))
                .FirstOrDefaultAsync();

            if (transfer == null) return NotFound();

            return View(transfer);
        }

        [HttpPost]
        public async Task<IActionResult> Edit(Transfer transfer)
        {
            if (ModelState.IsValid)
            {
                await _context.Database.ExecuteSqlRawAsync(
                    "EXEC sp_UpdateTransfer @TransferID, @ControlNo, @Warranty, @Quantity, @Location",
                    new SqlParameter("@TransferID", transfer.TransferID),
                    new SqlParameter("@ControlNo", transfer.ControlNo),
                    new SqlParameter("@Warranty", transfer.Warranty ?? (object)DBNull.Value),
                    new SqlParameter("@Quantity", transfer.Quantity),
                    new SqlParameter("@Location", transfer.Location)
                );

                return RedirectToAction(nameof(Index));
            }
            return View(transfer);
        }

        // ================= DELETE =====================
        public async Task<IActionResult> Delete(int id)
        {
            var transfer = await _context.Transfers
                .FromSqlRaw("EXEC sp_GetTransferById @Id", new SqlParameter("@Id", id))
                .FirstOrDefaultAsync();

            if (transfer == null) return NotFound();

            return View(transfer);
        }

        [HttpPost, ActionName("Delete")]
        public async Task<IActionResult> DeleteConfirmed(int id)
        {
            await _context.Database.ExecuteSqlRawAsync(
                "EXEC sp_DeleteTransfer @Id", new SqlParameter("@Id", id)
            );

            return RedirectToAction(nameof(Index));
        }
    }
}


---

‚úÖ Step 6 ‚Äî Views

üëâ Views/Transfer/Index.cshtml

@model IEnumerable<InventorySystem.Models.Transfer>

<h2>Transfer List</h2>

<p><a asp-action="Create" class="btn btn-primary">New Transfer</a></p>

<table class="table table-bordered">
    <thead>
        <tr>
            <th>ID</th>
            <th>Control No</th>
            <th>Warranty</th>
            <th>Quantity</th>
            <th>Location</th>
            <th>Date</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
@foreach (var t in Model)
{
    <tr>
        <td>@t.TransferID</td>
        <td>@t.ControlNo</td>
        <td>@t.Warranty</td>
        <td>@t.Quantity</td>
        <td>@t.Location</td>
        <td>@t.DateTransferred.ToShortDateString()</td>
        <td>
            <a asp-action="Edit" asp-route-id="@t.TransferID" class="btn btn-warning btn-sm">Edit</a>
            <a asp-action="Delete" asp-route-id="@t.TransferID" class="btn btn-danger btn-sm">Delete</a>
        </td>
    </tr>
}
    </tbody>
</table>


---

üëâ Views/Transfer/Create.cshtml

@model InventorySystem.Models.Transfer

<h2>New Transfer</h2>

<form asp-action="Create">
    <div class="mb-2">
        <label>Control No</label>
        <input asp-for="ControlNo" class="form-control" />
    </div>
    <div class="mb-2">
        <label>Warranty</label>
        <input asp-for="Warranty" class="form-control" />
    </div>
    <div class="mb-2">
        <label>Quantity</label>
        <input asp-for="Quantity" class="form-control" />
    </div>
    <div class="mb-2">
        <label>Location</label>
        <input asp-for="Location" class="form-control" />
    </div>

    <button class="btn btn-success">Save</button>
</form>


---

üëâ Views/Transfer/Edit.cshtml

Same as Create but with hidden ID:

@model InventorySystem.Models.Transfer

<h2>Edit Transfer</h2>

<form asp-action="Edit">
    <input type="hidden" asp-for="TransferID" />
    
    <div class="mb-2">
        <label>Control No</label>
        <input asp-for="ControlNo" class="form-control" />
    </div>

    <div class="mb-2">
        <label>Warranty</label>
        <input asp-for="Warranty" class="form-control" />
    </div>

    <div class="mb-2">
        <label>Quantity</label>
        <input asp-for="Quantity" class="form-control" />
    </div>

    <div class="mb-2">
        <label>Location</label>
        <input asp-for="Location" class="form-control" />
    </div>

    <button class="btn btn-primary">Update</button>
</form>


---

üëâ Views/Transfer/Delete.cshtml

@model InventorySystem.Models.Transfer

<h2>Delete Transfer</h2>

<p>Are you sure you want to delete this transfer?</p>

<form asp-action="Delete">
    <input type="hidden" asp-for="TransferID" />

    <button class="btn btn-danger">Delete</button>
    <a asp-action="Index" class="btn btn-secondary">Cancel</a>
</form>


---

‚ùó Important Note About Updating Item Location

If your goal is to update tbl_items.location when transferring,
add this to your stored procedure:

UPDATE tbl_items
SET Location = @Location
WHERE ControlNo = @ControlNo;

If you want, I can include this automatically in the transfer module.


---

üéâ Done!

You now have a complete Transfer module with:

Stored procedures

Model

Controller

Views

Full CRUD operations



---

Want me to integrate it with your Items module?

Example:

Auto-load item info based on Control No

Auto-update item location

Prevent over-transfer (quantity > stock)


Just tell me ‚ÄúYes integrate it!‚Äù

**

Perfect ‚Äî here is the FULL WORKING Transfer (Out) Module with Scenario A & Scenario B both included, using:

‚úî ASP.NET Core MVC 8
‚úî EF Core
‚úî SQL Server Stored Procedures
‚úî Auto Control No generation
‚úî Updates tbl_items.location correctly
‚úî Supports partial quantity (parent/child item)
‚úî Complete controller + models + views

This version is ready to paste into your project.


---

üü¶ 1. DATABASE STRUCTURE

tbl_items (supports serialized + quantity items)

CREATE TABLE tbl_items (
    ItemId INT IDENTITY(1,1) PRIMARY KEY,
    ItemName VARCHAR(100),
    SerialNo VARCHAR(100) NULL,         -- NULL = quantity item
    Quantity INT NOT NULL DEFAULT 1,
    Location VARCHAR(100),
    ParentItemId INT NULL,             -- used for partial transfers
    ItemType VARCHAR(20),              -- 'Serialized' OR 'Quantity'
    CreatedDate DATETIME DEFAULT GETDATE()
);


---

tbl_TransferOut (records ALL transfers)

CREATE TABLE tbl_TransferOut (
    TransferOutId INT IDENTITY(1,1) PRIMARY KEY,
    ItemId INT NOT NULL,
    ControlNo VARCHAR(50),
    Warranty VARCHAR(100),
    Quantity INT,
    Location VARCHAR(100),
    CreatedDate DATETIME DEFAULT GETDATE()
);


---

üü¶ 2. STORED PROCEDURES


---

SP A ‚Äì Serialized Item Transfer

(Updates location of the exact item)

CREATE OR ALTER PROCEDURE sp_TransferOut_Insert_A
    @ItemId INT,
    @ControlNo VARCHAR(50),
    @Warranty VARCHAR(100),
    @Quantity INT,
    @Location VARCHAR(100)
AS
BEGIN
    INSERT INTO tbl_TransferOut (ItemId, ControlNo, Warranty, Quantity, Location)
    VALUES (@ItemId, @ControlNo, @Warranty, @Quantity, @Location);

    UPDATE tbl_items
    SET Location = @Location
    WHERE ItemId = @ItemId;
END


---

SP B ‚Äì Quantity Item (Partial Transfer)

(Updates parent + creates child item)

CREATE OR ALTER PROCEDURE sp_TransferOut_Insert_B
    @ItemId INT,
    @ControlNo VARCHAR(50),
    @Warranty VARCHAR(100),
    @Quantity INT,
    @Location VARCHAR(100)
AS
BEGIN
    DECLARE @CurrentQty INT;
    DECLARE @ItemName VARCHAR(100);

    SELECT @CurrentQty = Quantity,
           @ItemName = ItemName
    FROM tbl_items
    WHERE ItemId = @ItemId;

    IF @Quantity > @CurrentQty
    BEGIN
        RAISERROR('Insufficient quantity in stock.', 16, 1);
        RETURN;
    END

    INSERT INTO tbl_TransferOut (ItemId, ControlNo, Warranty, Quantity, Location)
    VALUES (@ItemId, @ControlNo, @Warranty, @Quantity, @Location);

    UPDATE tbl_items
    SET Quantity = @CurrentQty - @Quantity
    WHERE ItemId = @ItemId;

    INSERT INTO tbl_items (ItemName, Quantity, Location, ParentItemId, ItemType)
    VALUES (@ItemName, @Quantity, @Location, @ItemId, 'Quantity');
END


---

üü¶ 3. MODEL CLASSES (C#)


---

TransferOut.cs

public class TransferOut
{
    public int TransferOutId { get; set; }
    public int ItemId { get; set; }
    public string ControlNo { get; set; }
    public string Warranty { get; set; }
    public int Quantity { get; set; }
    public string Location { get; set; }
    public DateTime CreatedDate { get; set; }

    // Extra for View
    public string ItemName { get; set; }
    public string ItemType { get; set; }
}


---

Item.cs

public class Item
{
    public int ItemId { get; set; }
    public string ItemName { get; set; }
    public string SerialNo { get; set; }
    public int Quantity { get; set; }
    public string Location { get; set; }
    public int? ParentItemId { get; set; }
    public string ItemType { get; set; }
}


---

üü¶ 4. DBCONTEXT

public class AppDbContext : DbContext
{
    public AppDbContext(DbContextOptions<AppDbContext> options)
        : base(options) { }

    public DbSet<Item> Items { get; set; }
    public DbSet<TransferOut> TransferOuts { get; set; }
}


---

üü¶ 5. CONTROLLER ‚Äî TransferOutController.cs

This includes auto Control No generation + logic for A and B.

public class TransferOutController : Controller
{
    private readonly AppDbContext _context;

    public TransferOutController(AppDbContext context)
    {
        _context = context;
    }

    private string GenerateControlNo()
    {
        return "TO-" + DateTime.Now.ToString("yyyyMMdd-HHmmss");
    }

    public async Task<IActionResult> Index()
    {
        var data = await _context.TransferOuts
            .FromSqlRaw("SELECT t.*, i.ItemName, i.ItemType FROM tbl_TransferOut t JOIN tbl_items i ON t.ItemId = i.ItemId ORDER BY t.TransferOutId DESC")
            .ToListAsync();

        return View(data);
    }

    public IActionResult Create()
    {
        ViewBag.Items = _context.Items.ToList();
        return View();
    }

    [HttpPost]
    public async Task<IActionResult> Create(TransferOut model)
    {
        var item = await _context.Items.FindAsync(model.ItemId);

        if (item == null)
        {
            ModelState.AddModelError("", "Item not found.");
            return View(model);
        }

        model.ControlNo = GenerateControlNo();

        if (item.ItemType == "Serialized")
        {
            await _context.Database.ExecuteSqlRawAsync(
                "EXEC sp_TransferOut_Insert_A @p0, @p1, @p2, @p3, @p4",
                model.ItemId, model.ControlNo, model.Warranty, model.Quantity, model.Location
            );
        }
        else
        {
            await _context.Database.ExecuteSqlRawAsync(
                "EXEC sp_TransferOut_Insert_B @p0, @p1, @p2, @p3, @p4",
                model.ItemId, model.ControlNo, model.Warranty, model.Quantity, model.Location
            );
        }

        return RedirectToAction(nameof(Index));
    }
}


---

üü¶ 6. VIEWS


---

Create.cshtml

@model TransferOut
@{
    ViewBag.Title = "Transfer Out";
}

<h2>Transfer Out</h2>

<form asp-action="Create" method="post">

    <div class="form-group">
        <label>Item</label>
        <select asp-for="ItemId" class="form-control">
            @foreach (var i in ViewBag.Items)
            {
                <option value="@i.ItemId">
                    @i.ItemName (@i.ItemType) - Stock: @i.Quantity
                </option>
            }
        </select>
    </div>

    <div class="form-group">
        <label>Warranty</label>
        <input asp-for="Warranty" class="form-control" />
    </div>

    <div class="form-group">
        <label>Quantity</label>
        <input asp-for="Quantity" class="form-control" type="number" value="1" />
    </div>

    <div class="form-group">
        <label>New Location</label>
        <input asp-for="Location" class="form-control" />
    </div>

    <button type="submit" class="btn btn-success mt-3">Submit</button>
</form>


---

Index.cshtml

@model IEnumerable<TransferOut>

<h2>Transfer Out Records</h2>

<table class="table table-bordered table-striped">
    <thead>
        <tr>
            <th>Control No</th>
            <th>Item</th>
            <th>Type</th>
            <th>Qty</th>
            <th>Location</th>
            <th>Date</th>
        </tr>
    </thead>
    <tbody>
        @foreach(var item in Model)
        {
            <tr>
                <td>@item.ControlNo</td>
                <td>@item.ItemName</td>
                <td>@item.ItemType</td>
                <td>@item.Quantity</td>
                <td>@item.Location</td>
                <td>@item.CreatedDate.ToString("yyyy-MM-dd HH:mm")</td>
            </tr>
        }
    </tbody>
</table>


---

üü© DONE! You now have a FULL Transfer (Out) module supporting:

‚úî Serialized items (Scenario A)

‚úî Quantity items with partial transfers (Scenario B)

‚úî Auto Control Number

‚úî Updates tbl_items correctly

‚úî Creates child items for partial transfers

‚úî Records complete transfer history

‚úî Full MVC + SP + Views ready to use


---

Want the Transfer (IN) module, Dispose module, Dashboard, or Stock Report next?

**

Below is a complete, beginner-friendly sample module for Transfer (Out) using ASP.NET Core MVC 8, EF Core, and Stored Procedures in SQL Server.

This example includes:

‚úî Database Table
‚úî Stored Procedures (Insert + List + GetById)
‚úî Model
‚úî DbContext configuration
‚úî Controller (CRUD logic using Stored Procedures ‚Üí no EF LINQ)
‚úî Views (Create + Index + Details)


---

‚úÖ 1. SQL SERVER ‚Äî TABLE

CREATE TABLE tbl_TransferOut (
    TransferOutId INT IDENTITY(1,1) PRIMARY KEY,
    ControlNo VARCHAR(50) NOT NULL,
    Warranty VARCHAR(100),
    Quantity INT NOT NULL,
    Location VARCHAR(100),
    CreatedDate DATETIME DEFAULT GETDATE()
);


---

‚úÖ 2. SQL SERVER ‚Äî STORED PROCEDURES

‚û§ Insert SP

CREATE OR ALTER PROCEDURE sp_TransferOut_Insert
    @ControlNo VARCHAR(50),
    @Warranty VARCHAR(100),
    @Quantity INT,
    @Location VARCHAR(100)
AS
BEGIN
    INSERT INTO tbl_TransferOut (ControlNo, Warranty, Quantity, Location)
    VALUES (@ControlNo, @Warranty, @Quantity, @Location);
END

‚û§ List All SP

CREATE OR ALTER PROCEDURE sp_TransferOut_List
AS
BEGIN
    SELECT * FROM tbl_TransferOut ORDER BY TransferOutId DESC;
END

‚û§ Get By ID SP

CREATE OR ALTER PROCEDURE sp_TransferOut_GetById
    @TransferOutId INT
AS
BEGIN
    SELECT * FROM tbl_TransferOut WHERE TransferOutId = @TransferOutId;
END


---

‚úÖ 3. MODEL ‚Äî TransferOut.cs

public class TransferOut
{
    public int TransferOutId { get; set; }
    public string ControlNo { get; set; }
    public string Warranty { get; set; }
    public int Quantity { get; set; }
    public string Location { get; set; }
    public DateTime CreatedDate { get; set; }
}


---

‚úÖ 4. DB CONTEXT ‚Äî register entity without EF table mapping (SP only)

public class AppDbContext : DbContext
{
    public AppDbContext(DbContextOptions<AppDbContext> options)
        : base(options) { }

    public DbSet<TransferOut> TransferOuts { get; set; }
}


---

‚úÖ 5. CONTROLLER ‚Äî TransferOutController.cs

This uses Stored Procedures only, no EF LINQ queries.

public class TransferOutController : Controller
{
    private readonly AppDbContext _context;

    public TransferOutController(AppDbContext context)
    {
        _context = context;
    }

    // ---------------- INDEX ----------------
    public async Task<IActionResult> Index()
    {
        var data = await _context.TransferOuts
            .FromSqlRaw("EXEC sp_TransferOut_List")
            .ToListAsync();

        return View(data);
    }

    // ---------------- DETAILS ----------------
    public async Task<IActionResult> Details(int id)
    {
        var data = await _context.TransferOuts
            .FromSqlRaw("EXEC sp_TransferOut_GetById @p0", id)
            .FirstOrDefaultAsync();

        if (data == null)
            return NotFound();

        return View(data);
    }

    // ---------------- CREATE ----------------
    public IActionResult Create()
    {
        return View();
    }

    [HttpPost]
    [ValidateAntiForgeryToken]
    public async Task<IActionResult> Create(TransferOut model)
    {
        if (!ModelState.IsValid)
            return View(model);

        await _context.Database.ExecuteSqlRawAsync(
            "EXEC sp_TransferOut_Insert @p0, @p1, @p2, @p3",
            model.ControlNo, model.Warranty, model.Quantity, model.Location
        );

        return RedirectToAction(nameof(Index));
    }
}


---

‚úÖ 6. VIEW ‚Äî /Views/TransferOut/Index.cshtml

@model IEnumerable<TransferOut>

<h2>Transfer (Out) List</h2>
<a class="btn btn-primary" href="/TransferOut/Create">New Transfer Out</a>
<br /><br />

<table class="table table-bordered table-striped">
    <thead>
        <tr>
            <th>Control No</th>
            <th>Warranty</th>
            <th>Qty</th>
            <th>Location</th>
            <th>Date</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        @foreach(var item in Model)
        {
            <tr>
                <td>@item.ControlNo</td>
                <td>@item.Warranty</td>
                <td>@item.Quantity</td>
                <td>@item.Location</td>
                <td>@item.CreatedDate.ToString("yyyy-MM-dd")</td>
                <td>
                    <a href="/TransferOut/Details/@item.TransferOutId" class="btn btn-sm btn-info">View</a>
                </td>
            </tr>
        }
    </tbody>
</table>


---

‚úÖ 7. VIEW ‚Äî /Views/TransferOut/Create.cshtml

@model TransferOut

<h2>New Transfer (Out)</h2>

<form asp-action="Create" method="post">

    <div class="form-group">
        <label>Control No</label>
        <input asp-for="ControlNo" class="form-control" />
    </div>

    <div class="form-group">
        <label>Warranty</label>
        <input asp-for="Warranty" class="form-control" />
    </div>

    <div class="form-group">
        <label>Quantity</label>
        <input asp-for="Quantity" class="form-control" type="number" />
    </div>

    <div class="form-group">
        <label>Location</label>
        <input asp-for="Location" class="form-control" />
    </div>

    <br />

    <button type="submit" class="btn btn-success">Save</button>
    <a href="/TransferOut" class="btn btn-secondary">Cancel</a>

</form>


---

‚úÖ 8. VIEW ‚Äî /Views/TransferOut/Details.cshtml

@model TransferOut

<h2>Transfer (Out) Details</h2>

<table class="table table-bordered">
    <tr><th>Control No</th><td>@Model.ControlNo</td></tr>
    <tr><th>Warranty</th><td>@Model.Warranty</td></tr>
    <tr><th>Quantity</th><td>@Model.Quantity</td></tr>
    <tr><th>Location</th><td>@Model.Location</td></tr>
    <tr><th>Created Date</th><td>@Model.CreatedDate</td></tr>
</table>

<a href="/TransferOut" class="btn btn-secondary">Back</a>


---

üéâ DONE!

You now have a full Transfer Out module:

‚úî Table
‚úî Stored Procedures
‚úî MVC + EF Core Code
‚úî Views
‚úî Clean, beginner-friendly


---

If you want, I can also add:

‚úÖ Auto-generate Control No
‚úÖ Add Item dropdown + stock validation
‚úÖ Add Partial Transfer logic (with parent/child item)
‚úÖ Add Transaction No logic
‚úÖ Add Search / Pagination (DataTables)

Just tell me!
