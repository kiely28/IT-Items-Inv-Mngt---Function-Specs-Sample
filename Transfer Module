Perfect â€” here is the FULL WORKING Transfer (Out) Module with Scenario A & Scenario B both included, using:

âœ” ASP.NET Core MVC 8
âœ” EF Core
âœ” SQL Server Stored Procedures
âœ” Auto Control No generation
âœ” Updates tbl_items.location correctly
âœ” Supports partial quantity (parent/child item)
âœ” Complete controller + models + views

This version is ready to paste into your project.


---

ðŸŸ¦ 1. DATABASE STRUCTURE

tbl_items (supports serialized + quantity items)

CREATE TABLE tbl_items (
    ItemId INT IDENTITY(1,1) PRIMARY KEY,
    ItemName VARCHAR(100),
    SerialNo VARCHAR(100) NULL,         -- NULL = quantity item
    Quantity INT NOT NULL DEFAULT 1,
    Location VARCHAR(100),
    ParentItemId INT NULL,             -- used for partial transfers
    ItemType VARCHAR(20),              -- 'Serialized' OR 'Quantity'
    CreatedDate DATETIME DEFAULT GETDATE()
);


---

tbl_TransferOut (records ALL transfers)

CREATE TABLE tbl_TransferOut (
    TransferOutId INT IDENTITY(1,1) PRIMARY KEY,
    ItemId INT NOT NULL,
    ControlNo VARCHAR(50),
    Warranty VARCHAR(100),
    Quantity INT,
    Location VARCHAR(100),
    CreatedDate DATETIME DEFAULT GETDATE()
);


---

ðŸŸ¦ 2. STORED PROCEDURES


---

SP A â€“ Serialized Item Transfer

(Updates location of the exact item)

CREATE OR ALTER PROCEDURE sp_TransferOut_Insert_A
    @ItemId INT,
    @ControlNo VARCHAR(50),
    @Warranty VARCHAR(100),
    @Quantity INT,
    @Location VARCHAR(100)
AS
BEGIN
    INSERT INTO tbl_TransferOut (ItemId, ControlNo, Warranty, Quantity, Location)
    VALUES (@ItemId, @ControlNo, @Warranty, @Quantity, @Location);

    UPDATE tbl_items
    SET Location = @Location
    WHERE ItemId = @ItemId;
END


---

SP B â€“ Quantity Item (Partial Transfer)

(Updates parent + creates child item)

CREATE OR ALTER PROCEDURE sp_TransferOut_Insert_B
    @ItemId INT,
    @ControlNo VARCHAR(50),
    @Warranty VARCHAR(100),
    @Quantity INT,
    @Location VARCHAR(100)
AS
BEGIN
    DECLARE @CurrentQty INT;
    DECLARE @ItemName VARCHAR(100);

    SELECT @CurrentQty = Quantity,
           @ItemName = ItemName
    FROM tbl_items
    WHERE ItemId = @ItemId;

    IF @Quantity > @CurrentQty
    BEGIN
        RAISERROR('Insufficient quantity in stock.', 16, 1);
        RETURN;
    END

    INSERT INTO tbl_TransferOut (ItemId, ControlNo, Warranty, Quantity, Location)
    VALUES (@ItemId, @ControlNo, @Warranty, @Quantity, @Location);

    UPDATE tbl_items
    SET Quantity = @CurrentQty - @Quantity
    WHERE ItemId = @ItemId;

    INSERT INTO tbl_items (ItemName, Quantity, Location, ParentItemId, ItemType)
    VALUES (@ItemName, @Quantity, @Location, @ItemId, 'Quantity');
END


---

ðŸŸ¦ 3. MODEL CLASSES (C#)


---

TransferOut.cs

public class TransferOut
{
    public int TransferOutId { get; set; }
    public int ItemId { get; set; }
    public string ControlNo { get; set; }
    public string Warranty { get; set; }
    public int Quantity { get; set; }
    public string Location { get; set; }
    public DateTime CreatedDate { get; set; }

    // Extra for View
    public string ItemName { get; set; }
    public string ItemType { get; set; }
}


---

Item.cs

public class Item
{
    public int ItemId { get; set; }
    public string ItemName { get; set; }
    public string SerialNo { get; set; }
    public int Quantity { get; set; }
    public string Location { get; set; }
    public int? ParentItemId { get; set; }
    public string ItemType { get; set; }
}


---

ðŸŸ¦ 4. DBCONTEXT

public class AppDbContext : DbContext
{
    public AppDbContext(DbContextOptions<AppDbContext> options)
        : base(options) { }

    public DbSet<Item> Items { get; set; }
    public DbSet<TransferOut> TransferOuts { get; set; }
}


---

ðŸŸ¦ 5. CONTROLLER â€” TransferOutController.cs

This includes auto Control No generation + logic for A and B.

public class TransferOutController : Controller
{
    private readonly AppDbContext _context;

    public TransferOutController(AppDbContext context)
    {
        _context = context;
    }

    private string GenerateControlNo()
    {
        return "TO-" + DateTime.Now.ToString("yyyyMMdd-HHmmss");
    }

    public async Task<IActionResult> Index()
    {
        var data = await _context.TransferOuts
            .FromSqlRaw("SELECT t.*, i.ItemName, i.ItemType FROM tbl_TransferOut t JOIN tbl_items i ON t.ItemId = i.ItemId ORDER BY t.TransferOutId DESC")
            .ToListAsync();

        return View(data);
    }

    public IActionResult Create()
    {
        ViewBag.Items = _context.Items.ToList();
        return View();
    }

    [HttpPost]
    public async Task<IActionResult> Create(TransferOut model)
    {
        var item = await _context.Items.FindAsync(model.ItemId);

        if (item == null)
        {
            ModelState.AddModelError("", "Item not found.");
            return View(model);
        }

        model.ControlNo = GenerateControlNo();

        if (item.ItemType == "Serialized")
        {
            await _context.Database.ExecuteSqlRawAsync(
                "EXEC sp_TransferOut_Insert_A @p0, @p1, @p2, @p3, @p4",
                model.ItemId, model.ControlNo, model.Warranty, model.Quantity, model.Location
            );
        }
        else
        {
            await _context.Database.ExecuteSqlRawAsync(
                "EXEC sp_TransferOut_Insert_B @p0, @p1, @p2, @p3, @p4",
                model.ItemId, model.ControlNo, model.Warranty, model.Quantity, model.Location
            );
        }

        return RedirectToAction(nameof(Index));
    }
}


---

ðŸŸ¦ 6. VIEWS


---

Create.cshtml

@model TransferOut
@{
    ViewBag.Title = "Transfer Out";
}

<h2>Transfer Out</h2>

<form asp-action="Create" method="post">

    <div class="form-group">
        <label>Item</label>
        <select asp-for="ItemId" class="form-control">
            @foreach (var i in ViewBag.Items)
            {
                <option value="@i.ItemId">
                    @i.ItemName (@i.ItemType) - Stock: @i.Quantity
                </option>
            }
        </select>
    </div>

    <div class="form-group">
        <label>Warranty</label>
        <input asp-for="Warranty" class="form-control" />
    </div>

    <div class="form-group">
        <label>Quantity</label>
        <input asp-for="Quantity" class="form-control" type="number" value="1" />
    </div>

    <div class="form-group">
        <label>New Location</label>
        <input asp-for="Location" class="form-control" />
    </div>

    <button type="submit" class="btn btn-success mt-3">Submit</button>
</form>


---

Index.cshtml

@model IEnumerable<TransferOut>

<h2>Transfer Out Records</h2>

<table class="table table-bordered table-striped">
    <thead>
        <tr>
            <th>Control No</th>
            <th>Item</th>
            <th>Type</th>
            <th>Qty</th>
            <th>Location</th>
            <th>Date</th>
        </tr>
    </thead>
    <tbody>
        @foreach(var item in Model)
        {
            <tr>
                <td>@item.ControlNo</td>
                <td>@item.ItemName</td>
                <td>@item.ItemType</td>
                <td>@item.Quantity</td>
                <td>@item.Location</td>
                <td>@item.CreatedDate.ToString("yyyy-MM-dd HH:mm")</td>
            </tr>
        }
    </tbody>
</table>


---

ðŸŸ© DONE! You now have a FULL Transfer (Out) module supporting:

âœ” Serialized items (Scenario A)

âœ” Quantity items with partial transfers (Scenario B)

âœ” Auto Control Number

âœ” Updates tbl_items correctly

âœ” Creates child items for partial transfers

âœ” Records complete transfer history

âœ” Full MVC + SP + Views ready to use


---

Want the Transfer (IN) module, Dispose module, Dashboard, or Stock Report next?

**

Below is a complete, beginner-friendly sample module for Transfer (Out) using ASP.NET Core MVC 8, EF Core, and Stored Procedures in SQL Server.

This example includes:

âœ” Database Table
âœ” Stored Procedures (Insert + List + GetById)
âœ” Model
âœ” DbContext configuration
âœ” Controller (CRUD logic using Stored Procedures â†’ no EF LINQ)
âœ” Views (Create + Index + Details)


---

âœ… 1. SQL SERVER â€” TABLE

CREATE TABLE tbl_TransferOut (
    TransferOutId INT IDENTITY(1,1) PRIMARY KEY,
    ControlNo VARCHAR(50) NOT NULL,
    Warranty VARCHAR(100),
    Quantity INT NOT NULL,
    Location VARCHAR(100),
    CreatedDate DATETIME DEFAULT GETDATE()
);


---

âœ… 2. SQL SERVER â€” STORED PROCEDURES

âž¤ Insert SP

CREATE OR ALTER PROCEDURE sp_TransferOut_Insert
    @ControlNo VARCHAR(50),
    @Warranty VARCHAR(100),
    @Quantity INT,
    @Location VARCHAR(100)
AS
BEGIN
    INSERT INTO tbl_TransferOut (ControlNo, Warranty, Quantity, Location)
    VALUES (@ControlNo, @Warranty, @Quantity, @Location);
END

âž¤ List All SP

CREATE OR ALTER PROCEDURE sp_TransferOut_List
AS
BEGIN
    SELECT * FROM tbl_TransferOut ORDER BY TransferOutId DESC;
END

âž¤ Get By ID SP

CREATE OR ALTER PROCEDURE sp_TransferOut_GetById
    @TransferOutId INT
AS
BEGIN
    SELECT * FROM tbl_TransferOut WHERE TransferOutId = @TransferOutId;
END


---

âœ… 3. MODEL â€” TransferOut.cs

public class TransferOut
{
    public int TransferOutId { get; set; }
    public string ControlNo { get; set; }
    public string Warranty { get; set; }
    public int Quantity { get; set; }
    public string Location { get; set; }
    public DateTime CreatedDate { get; set; }
}


---

âœ… 4. DB CONTEXT â€” register entity without EF table mapping (SP only)

public class AppDbContext : DbContext
{
    public AppDbContext(DbContextOptions<AppDbContext> options)
        : base(options) { }

    public DbSet<TransferOut> TransferOuts { get; set; }
}


---

âœ… 5. CONTROLLER â€” TransferOutController.cs

This uses Stored Procedures only, no EF LINQ queries.

public class TransferOutController : Controller
{
    private readonly AppDbContext _context;

    public TransferOutController(AppDbContext context)
    {
        _context = context;
    }

    // ---------------- INDEX ----------------
    public async Task<IActionResult> Index()
    {
        var data = await _context.TransferOuts
            .FromSqlRaw("EXEC sp_TransferOut_List")
            .ToListAsync();

        return View(data);
    }

    // ---------------- DETAILS ----------------
    public async Task<IActionResult> Details(int id)
    {
        var data = await _context.TransferOuts
            .FromSqlRaw("EXEC sp_TransferOut_GetById @p0", id)
            .FirstOrDefaultAsync();

        if (data == null)
            return NotFound();

        return View(data);
    }

    // ---------------- CREATE ----------------
    public IActionResult Create()
    {
        return View();
    }

    [HttpPost]
    [ValidateAntiForgeryToken]
    public async Task<IActionResult> Create(TransferOut model)
    {
        if (!ModelState.IsValid)
            return View(model);

        await _context.Database.ExecuteSqlRawAsync(
            "EXEC sp_TransferOut_Insert @p0, @p1, @p2, @p3",
            model.ControlNo, model.Warranty, model.Quantity, model.Location
        );

        return RedirectToAction(nameof(Index));
    }
}


---

âœ… 6. VIEW â€” /Views/TransferOut/Index.cshtml

@model IEnumerable<TransferOut>

<h2>Transfer (Out) List</h2>
<a class="btn btn-primary" href="/TransferOut/Create">New Transfer Out</a>
<br /><br />

<table class="table table-bordered table-striped">
    <thead>
        <tr>
            <th>Control No</th>
            <th>Warranty</th>
            <th>Qty</th>
            <th>Location</th>
            <th>Date</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        @foreach(var item in Model)
        {
            <tr>
                <td>@item.ControlNo</td>
                <td>@item.Warranty</td>
                <td>@item.Quantity</td>
                <td>@item.Location</td>
                <td>@item.CreatedDate.ToString("yyyy-MM-dd")</td>
                <td>
                    <a href="/TransferOut/Details/@item.TransferOutId" class="btn btn-sm btn-info">View</a>
                </td>
            </tr>
        }
    </tbody>
</table>


---

âœ… 7. VIEW â€” /Views/TransferOut/Create.cshtml

@model TransferOut

<h2>New Transfer (Out)</h2>

<form asp-action="Create" method="post">

    <div class="form-group">
        <label>Control No</label>
        <input asp-for="ControlNo" class="form-control" />
    </div>

    <div class="form-group">
        <label>Warranty</label>
        <input asp-for="Warranty" class="form-control" />
    </div>

    <div class="form-group">
        <label>Quantity</label>
        <input asp-for="Quantity" class="form-control" type="number" />
    </div>

    <div class="form-group">
        <label>Location</label>
        <input asp-for="Location" class="form-control" />
    </div>

    <br />

    <button type="submit" class="btn btn-success">Save</button>
    <a href="/TransferOut" class="btn btn-secondary">Cancel</a>

</form>


---

âœ… 8. VIEW â€” /Views/TransferOut/Details.cshtml

@model TransferOut

<h2>Transfer (Out) Details</h2>

<table class="table table-bordered">
    <tr><th>Control No</th><td>@Model.ControlNo</td></tr>
    <tr><th>Warranty</th><td>@Model.Warranty</td></tr>
    <tr><th>Quantity</th><td>@Model.Quantity</td></tr>
    <tr><th>Location</th><td>@Model.Location</td></tr>
    <tr><th>Created Date</th><td>@Model.CreatedDate</td></tr>
</table>

<a href="/TransferOut" class="btn btn-secondary">Back</a>


---

ðŸŽ‰ DONE!

You now have a full Transfer Out module:

âœ” Table
âœ” Stored Procedures
âœ” MVC + EF Core Code
âœ” Views
âœ” Clean, beginner-friendly


---

If you want, I can also add:

âœ… Auto-generate Control No
âœ… Add Item dropdown + stock validation
âœ… Add Partial Transfer logic (with parent/child item)
âœ… Add Transaction No logic
âœ… Add Search / Pagination (DataTables)

Just tell me!
